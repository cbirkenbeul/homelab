---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1beta1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name strava-statistics-secret
  namespace: default
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: *name
    template:
      engineVersion: v2
      data:
        config.yaml: |
          ---
          general:
            app_url: 'https://strava.${SECRET_DOMAIN}'
            profile_picture_url: null
            ntfy_url: null
            athlete:
              birthday: '{{ .ATHLETE_BIRTHDAY }}'
              max_heart_rate_formula: 'fox'
              # max_heart_rate_formula:
              #    "2020-01-01": 198
              #    "2025-01-10": 193
              # History of weight (in kg or pounds, depending on UNIT_SYSTEM). Needed to calculate relative w/kg.
              # Check https://github.com/robiningelbrecht/statistics-for-strava/wiki for more info.
              heartRateZones:
                mode: relative
                default:
                  zone1:
                    from: 50
                    to: 60
                  zone2:
                    from: 61
                    to: 70
                  zone3:
                    from: 71
                    to: 80
                  zone4:
                    from: 81
                    to: 90
                  zone5:
                    from: 91
                    to: null # Infinity and beyond.
              weight_history: 
                "2025-05-29": 73
                "2025-01-01": 72
                "2024-01-01": 73
                "2023-01-01": 73
                "2022-01-01": 75
                "2021-01-01": 76
              ftp_history: []
          appearance:
            locale: 'de_DE'
            unit_system: 'metric'
            time_format: 24
            date_format: 'DAY-MONTH-YEAR'
          import:
            number_of_new_activities_to_process_per_import: 250
            sport_types_to_import: []
            activity_visibilities_to_import: []
            skip_activities_recorded_before: '2024-01-01'
            activities_to_skip_during_import: []
          zwift:
            level: null
            racing_score: null
          metrics:
            consistencyChallenges:
              - label: 'Complete a 5 km run'
                enabled: true
                type: 'distanceInOneActivity'
                unit: 'km'
                goal: 5
                sportTypesToInclude: ['Run', 'TrailRun', 'VirtualRun']
              - label: 'Complete a 10 km run'
                enabled: true
                type: 'distanceInOneActivity'
                unit: 'km'
                goal: 10
                sportTypesToInclude: ['Run', 'TrailRun', 'VirtualRun']
              - label: 'Complete a half marathon run'
                enabled: true
                type: 'distanceInOneActivity'
                unit: 'km'
                goal: 21.1
                sportTypesToInclude: ['Run', 'TrailRun', 'VirtualRun']     
              - label: 'Run a total of 100km'
                enabled: true
                type: 'distance'
                unit: 'km'
                goal: 100
                sportTypesToInclude: ['Run', 'TrailRun', 'VirtualRun']
          integrations:
            ai:
              enabled: true
              enableUI: true
              provider: 'openAI'
              configuration:
                key: "{{ .CHATGPTAPIKEY }}"
                model: 'GPT-4o'
        # App
        STRAVA_CLIENT_ID: "{{ .STRAVA_CLIENT_ID }}"
        STRAVA_CLIENT_SECRET: "{{ .STRAVA_CLIENT_SECRET }}"
        STRAVA_REFRESH_TOKEN: "{{ .STRAVA_REFRESH_TOKEN }}"
  dataFrom:
    - extract:
        key: strava-statistics
