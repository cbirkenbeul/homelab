---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/externalsecret_v1beta1.json
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: &name strava-statistics-secret
  namespace: default
spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: *name
    template:
      engineVersion: v2
      data:
        config.yaml: |
          ---
          general:
            app_url: 'https://strava.${SECRET_DOMAIN}'
            profile_picture_url: null
            ntfy_url: null
            athlete:
              birthday: '1982-06-12'
              max_heart_rate_formula: 'fox'
              # max_heart_rate_formula:
              #    "2020-01-01": 198
              #    "2025-01-10": 193
              # History of weight (in kg or pounds, depending on UNIT_SYSTEM). Needed to calculate relative w/kg.
              # Check https://github.com/robiningelbrecht/statistics-for-strava/wiki for more info.
              weight_history: 
                "2025-05-29": 73
                "2025-01-01": 72
                "2024-01-01": 73
                "2023-01-01": 73
                "2022-01-01": 75
                "2021-01-01": 76
              # Optional, history of FTP. Needed to calculate activity stress level.
              # Check https://github.com/robiningelbrecht/statistics-for-strava/wiki for more info. Example:
              # ftp_history
              #    "2024-10-03": 198
              #    "2025-01-10": 220
              #
              ftp_history: []
          appearance:
            # Allowed options: en_US, fr_FR, nl_BE, de_DE, pt_BR, pt_PT or zh_CN
            locale: 'de_DE'
            # Allowed options: metric or imperial
            unit_system: 'metric'
            # Time format to use when rendering the app
            # Allowed formats: 24 or 12 (includes AM and PM)
            time_format: 24
            # Date format to use when rendering the app
            # Allowed formats: DAY-MONTH-YEAR or MONTH-DAY-YEAR
            date_format: 'DAY-MONTH-YEAR'
          import:
            number_of_new_activities_to_process_per_import: 250
            sport_types_to_import: []
            activity_visibilities_to_import: []
            skip_activities_recorded_before: '2024-01-01'
            activities_to_skip_during_import: []
          zwift:
            level: null
            racing_score: null

          integrations:
            ai:
              enabled: true
              enableUI: true
              provider: 'chatgpt'
              configuration:
                key: !env_var CHATGPTAPIKEY
                model: 'GPT-4o'
        # App
        STRAVA_CLIENT_ID: "{{ .STRAVA_CLIENT_ID }}"
        STRAVA_CLIENT_SECRET: "{{ .STRAVA_CLIENT_SECRET }}"
        STRAVA_REFRESH_TOKEN: "{{ .STRAVA_REFRESH_TOKEN }}"
        CHATGPTAPIKEY: "{{ .CHATGPTAPIKEY }}"
  dataFrom:
    - extract:
        key: strava-statistics
